<h1 align="center">Проектирование базы данных telegram</h1>

## Описание проекта:

В качестве проекта, выбран мессенджер telegram. Главная задача проекта - это спроектировать 
базу данных мессенджера. Создание структуры базы данных оценивается возможностями мессенджера, 
рассматривая структуру визуально, можно предположить как она работает на уровне базы данных,
исходя из проектируется структура базы данных.

**Этапы  проекта:**
1. [Написание SQL-кода таблиц](##Файлы-проекта:)
2. Заполнение базы данных тестовыми данными;
3. Обработка ошибочно сгенерированных данных;
4. Создание связей между таблицами;
5. Написание запросов на извлечение данных.

## Файлы проекта:

### [`database_structure.sql`](https://github.com/finloukuritsun2090/Projects-for-Resume/blob/master/database-design/database_structure.sql)
Главный файл, который содержит структур базы данных в виде SQL-кода.
Для последющей работы, было создано 17 основных таблиц.

Данный файл, хорошо демонстрирует тему "Проектирования БД".

Данный код реализует:
 * __Регистрацию пользователей в системе, для этого используются таблицы:__
   * <i>users</i> - Таблица пользователей;
   * <i>profiles</i> - Профиль пользователя, используется для хранения основной информации о пользователе.
 * __Возможность добавлять других пользователей в контакты, для этого используются таблицы:__
   * <i>contacts</i> - Таблица связи пользователей (друзья);
   * <i>contacts_statuses</i> - Указывает состояние между двумя пользователями 
   (принял заявку, удалён из контактов...).
 * __Создание групп:__
   * groups - Регистрации групп в системе;
   * groups_users - Таблица свзязи пользователй и групп (участники группы);
   * user_types - Указывает тип пользователя в группе (Создатель, администратор, модератор).
 * __Создание каналов:__
   * communities - Регистрацие каналов в системе;
   * communities_users - Таблица свзязи пользователй и каналов (участники канала);
   * posts - Публикация контента в формате "поста" для каналов;
   * views - Сохранение пользователей, которые посмотрели пост;
   * user_types - Тип пользователя в канале (создатель, администратор, модератор).
 * __Загрузка медиафайлов:__
   * media - Сохранение медиафайлов пользователя;
   * media_types - Тип медиафайла (архив, видео, аудио...);
 * __Общение между пользователями:__
   * messages - Хранит текст сообщения и автора;
   * target_types - Указывает кому адрессовано сообщение (пользователю, группа);
   * messages_statuses - Статус сообщения (отправлено, доставлено, прочитано...);
   * messages_users - Устанавливает связь между отправителем и получаетелем.
 
`telegram_data.sql` - Файл содержит тестовые данные, которые испольлзуются для проверки базы данных.
Генерация данных произовдилась сервисом "http://filldb.info/". Так как сервис имеет свои недостатки, данные 
придется обработать, чтобы не нарушалась целостность данных в системе, иначе будет невозможно создать связи 
между таблицами.

[`data_processing.sql`](https://github.com/finloukuritsun2090/Projects-for-Resume/blob/master/database-design/data_processing.sql) - Файл представляет собой SQL-команды, которые используются для обработки данных.

Данный файл, хорошо демонстрирует тему "CRUD-операций".

[`procedure_messages_users.sql`](https://github.com/finloukuritsun2090/Projects-for-Resume/blob/master/database-design/procedure_messages_users.sql) - Данный файл, вынесенная часть из файла __data_processing.sql__. 

В процессе обработки данных таблицы messages_users, была задача восстановить целостность данных значений, которые 
ссылаются на несуществующие идентификаторы таблицы. Для решение проблемы, был написан запрос генерации значений 
в пределе существующих идентификаторов. Так как данный запрос потребовалось запустить огромное количество раз для 
восстановления целостности данных, то пришлось создать для процедуру.

Функция используется для проверки, имеются ли ещё данные, которые необходимо обновить, если да, функция возвращает TRUE,
иначе FALSE.

Процедура выполняет обновление записей по циклу, внутри которго встроена команда UPDATE, цикл работает до тех пор, 
пока функция возвращает TRUE, если функция вернула FALSE, тогда все записи считаются обновленными.

Данная проблема стала причиной, по которой, набор этих команд был вынесен в отдельный файл.
